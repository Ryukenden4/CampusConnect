<!DOCTYPE html>

<html lang="en">
    <head style="background-color: #f1f1f1;"> 
        <link rel="stylesheet" href="/collegeRegistration/css/registerStyle.css"> 
        <!-- basic -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- mobile metas -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
        <!-- site metas -->
        <title>College InfoCenter</title>
        <meta name="keywords" content="">
        <meta name="description" content="">
        <meta name="author" content="">
        <!-- bootstrap css -->
        <link rel="stylesheet" type="text/css" href="/intermediate/css/bootstrap.min.css">
        <!-- style css -->
        <link rel="stylesheet" type="text/css" href="/intermediate/css/style.css">
        <link rel="stylesheet" type="text/css" href="/facilitiesBooking/assets/css/booking.css">
        <!-- Responsive-->
        <link rel="stylesheet" href="css/responsive.css">
        <!-- font css -->
        <link href="https://fonts.googleapis.com/css2?family=Sen:wght@400;700;800&display=swap" rel="stylesheet">
        <!-- Scrollbar Custom CSS -->
        <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
        <!-- Tweaks for older IEs-->
        <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
        <!-- header -->
        <link rel="stylesheet" href="/homepage/assets/css/bootstrap.css">
        <link rel="stylesheet" href="/homepage/assets/css/maicons.css">
        <link rel="stylesheet" href="/homepage/assets/css/theme.css">

        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type='text/css'>
        <link rel="stylesheet" href="/collegeRegistration/admin/style.css">
    </head>

<body>
    <!--header-->
    <header style="background-color: white;">
        <nav class="navbar navbar-expand-lg navbar-light shadow-sm">
            <div class="container">
                <a class="navbar-brand" href="/intermediate/student.html"><span class="text-primary">College</span> InfoCenter</a>
    
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupport" aria-controls="navbarSupport" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
    
                <div class="collapse navbar-collapse" id="navbarSupport">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item ">
                            <a class="nav-link " style="font-size: 14px;" href="/intermediate/student.html">Home</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="registrationDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: 14px;" >
                                Registration
                            </a>
                            <div class="dropdown-menu" aria-labelledby="registrationDropdown">
                                <a class="dropdown-item" href="/collegeRegistration/html/collegeApply.html">College Registration</a>
                                <a class="dropdown-item" href="/programRegistration/php/student.php">Programme Registration</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/facilitiesBooking/html/student.html" style="font-size: 14px;">Facilities Booking</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/customerSupport/html/customer.html" style="font-size: 14px;">Customer Support</a>
                        </li>
                        <!-- Add this within your navigation bar where you want the logout button to appear -->
                        <li class="nav-item">
                            <form action="/logout/logout.php" method="post">
                                <input type="submit" class="btn btn-primary ml-lg-3" style="background-color: #8b0000;" value="Logout">
                            </form>
                        </li>
                    </ul>
                </div> <!-- .navbar-collapse -->
            </div> <!-- .container -->
        </nav>
    </header>

    <!--content-->
    <div class="content">
    
        <main class="table">
            <div class="title">
                <h1 style="color: black;"><b>FACILITIES BOOKING</b></h1>
            </div>
        
        <section class="table__body">
            <table style="color: black;">
                
                <!-- User details -->
                <div class="user" id="userDetails">
                    <p id="studentId"></p>
                    <p id="fullName"></p>
                    <p id="college"></p>
                </div>
                
                <!-- Search form -->
                <div class="searchForm" >
                <div id="searchForm">
                    <label for="bookingDate">Date:</label>
                    <input type="date" id="bookingDate">
                
                    <label for="facilityType">Facility Type:</label>
                    <select id="facilityType">
                        <option value="meetingRoom">Meeting Room</option>
                        <option value="readingRoom">Reading Room</option>
                        <option value="gym">Gym</option>
                    </select>
                
                    <button onclick="searchSlots()">Search</button>
                </div>
                </div>
                
                <!-- Booking slots table -->
                <table id="bookingTable">
                    <!-- Table headers go here -->
                </table>

    
                </tbody>
            </table>
        </section>

        <div class="input-field" style="padding-left: 40px;">
          
          <button type="button" onclick="goBack()" style="background-color: #8b0000; color: white;"  class="btn">Back</button>
        </div>
    </main>
    </div>
    

    <!-- footer 
    <div class="copyright_section">
        <div class="container">
            <p class="copyright_text">2023 All Rights Reserved. Design by <a href="#">Team Muizz</a></p>
        </div>
    </div>-->
    
</body>



<!--for header baru-->
<script src="/homepage/assets/js/jquery-3.5.1.min.js"></script>
<script src="/homepage/assets/js/bootstrap.bundle.min.js"></script>

<script src="script.js"></script>

<script>
    // Fetch user details when the DOM is loaded
    document.addEventListener("DOMContentLoaded", function () {
        console.log('DOM content loaded');
        fetchUserDetails();
    });

    // Function to fetch and update user details
    function fetchUserDetails() {
        fetch('/intermediate/user.php')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update the user details in the HTML
                    const userDetails = data.userDetails;
                    document.getElementById('studentId').innerText = `Student ID: ${userDetails.studentId}`;
                    document.getElementById('fullName').innerText = `Full Name: ${userDetails.fullName}`;
                    document.getElementById('college').innerText = `College: ${userDetails.college}`;
                } else {
                    console.error('Error:', data.message);
                }
            })
        .catch(error => console.error('Error:', error));
    }

    // Function to search for available slots
    function searchSlots() {
        // Implement the logic to fetch available slots from the server
        // and update the booking table
        const bookingDate = document.getElementById("bookingDate").value;
        const facilityType = document.getElementById("facilityType").value;

        // For demonstration purposes, create dummy data
        const availableSlots = [
            { time: "08:00 AM - 09:00 AM", available: true },
            { time: "09:00 AM - 10:00 AM", available: false },
            { time: "10:00 AM - 11:00 AM", available: true },
            { time: "11:00 AM - 12:00 PM", available: false },
            { time: "12:00 PM - 01:00 PM", available: true },
            { time: "02:00 PM - 03:00 PM", available: true },
            { time: "03:00 PM - 04:00 PM", available: true },
            { time: "04:00 PM - 05:00 PM", available: true },
            { time: "05:00 PM - 06:00 PM", available: true },
             // Add more slots as needed
        ];

        updateBookingTable(availableSlots);
    }

    // Function to update the booking table
    function updateBookingTable(slots) {
        const table = document.getElementById("bookingTable");
        // Clear existing rows
        table.innerHTML = "";

        // Create headers
        const headerRow = table.insertRow();
        const timeHeader = headerRow.insertCell();
        const actionHeader = headerRow.insertCell();
        timeHeader.innerHTML = "<strong>Time</strong>";
        actionHeader.innerHTML = "<strong>Action</strong>";

        // Populate the table with slots
        slots.forEach(slot => {
            const row = table.insertRow();
            const timeCell = row.insertCell();
            const actionCell = row.insertCell();

            timeCell.textContent = slot.time;

            if (slot.available) {
                // If the slot is available, add a button to book it
                const bookButton = document.createElement("button");
                bookButton.textContent = "Book";
                bookButton.addEventListener("click", function () {
                    bookSlot(slot.time);
                });
                    actionCell.appendChild(bookButton);
                } else {
                    actionCell.textContent = "Unvailable";
                }
            });
        }

        // Function to book a slot
function bookSlot(time) {
    // Fetch user details
    const studentId = document.getElementById('studentId').innerText.split(':')[1].trim();
    const fullName = document.getElementById('fullName').innerText.split(':')[1].trim();
    const college = document.getElementById('college').innerText.split(':')[1].trim();
    
    // Fetch booking details
    const bookingDate = document.getElementById("bookingDate").value;
    const facilityType = document.getElementById("facilityType").value;

    // Prepare data to send
    const bookingData = {
        studentId,
        fullName,
        dateofBooking: bookingDate,
        college,
        facilities: facilityType,
        startTime: time.split(' - ')[0],
        endTime: time.split(' - ')[1]
    };

    // Send AJAX request to book the facility slot
    fetch('/facilitiesBooking/html/booking.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(bookingData),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Handle booking success
            showBookingSuccess();
        } else {
            // Handle booking failure
            console.error('Booking failed:', data.message);
        }
    })
    .catch(error => console.error('Error:', error));
}

        // Function to show booking success
        function showBookingSuccess() {
            alert('Booking successfully made!');
            window.location.href = '/intermediate/student.html';
        }

        // Function to cancel booking
        function cancelBooking() {
            window.location.href = '/facilitiesBooking/html/student.html';
        }

        function goBack() {
            // Redirect to another HTML file
            window.location.href = '/facilitiesBooking/html/student.html'; 
        }

</script>

</html>